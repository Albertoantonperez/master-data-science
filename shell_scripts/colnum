#!/bin/zsh

show_help() {
echo "

  colnum:	Numbers the columns of a csv file for easy reference

  Usage: colnum [-e] [-s sep] filename

  -e            Show example [default no]
  -s            Field delimiter [default ^]
  -h            Show this help
  filename      File to list columns. Required

  Examples:     colnum somefile.csv
                colnum -e somefile.csv
                colnum -s '|' somefile.csv
                colnum -es '#' somefile.csv

"
}


sep="^"
ex=0

# The first : is to avoid printing errors at reading parameters
while getopts ":es:h" opt; do
  case $opt in
    e)
      ex=1;;
    s)
      sep=$OPTARG;;
    h)
      show_help
      exit 0;;
    \?)
      echo "Invalid option: -$OPTARG." >&2
      show_help
      exit 2;;
  esac
done

#This tells getopts to move on to the next argument.
shift $(($OPTIND-1))

if [ -z "$1" ]; then
  echo "Error, you must specify a filename."
  show_help
  exit 1
fi

awk -F"$sep" -v awk_ex=$ex '
  BEGIN{
    split("", body)
  }
  (FNR==1) {
    split($0, header)
  }
  (FNR==2 && awk_ex) {
    split($0, body)
    exit 0
  }
  END {
    for (i in header) {
      resto = (length(body) > 0) ? " -> " body[i] : ""
      print i ". " header[i] resto
    }
 }' "$1"
